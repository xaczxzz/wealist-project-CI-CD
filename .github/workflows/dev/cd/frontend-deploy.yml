name: Frontend S3/CloudFront Deployment

on:
  # Frontend CI ì›Œí¬í”Œë¡œìš° ì„±ê³µ ì‹œ íŠ¸ë¦¬ê±°
  workflow_run:
    # TODO: CI ì›Œí¬í”Œë¡œìš°ì˜ íŒŒì¼ëª…ì— ë§ì¶° ìˆ˜ì •í•´ ì£¼ì„¸ìš”. (ì˜ˆ: frontend-ci.yml)
    workflows: ["Frontend CI/CD to S3/CloudFront"] 
    types:
      - completed
    branches:
      - main        # ìµœì¢… ë°°í¬ ë¸Œëœì¹˜

jobs:
  deploy:
    # CI ì›Œí¬í”Œë¡œìš°ê°€ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆì„ ë•Œë§Œ ì‹¤í–‰
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    environment: development # GitHub í™˜ê²½ ì„¤ì • (Secrets ê´€ë¦¬ ìš©ì´)

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        # ë¹Œë“œëœ ì •ì  íŒŒì¼ì€ CIì—ì„œ Artifactë¡œ ì €ì¥í•´ì•¼ í•˜ì§€ë§Œ, 
        # í˜„ì¬ CIëŠ” S3ì— ì§ì ‘ ë°°í¬í•˜ëŠ” êµ¬ì¡°ì´ë¯€ë¡œ, CDì—ì„œëŠ” S3 IDë§Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì— ì§‘ì¤‘í•©ë‹ˆë‹¤.
        # â­ ì°¸ê³ : ì´ìƒì ì¸ CI/CDëŠ” CIì—ì„œ ë¹Œë“œëœ Artifactë¥¼ ë‹¤ìš´ë°›ì•„ ë°°í¬í•©ë‹ˆë‹¤. 

      # 1. Terraform Output ê°€ì ¸ì˜¤ê¸° (S3 ë²„í‚· ì´ë¦„ ë° CloudFront ID í™•ë³´)
      - name: ğŸ–¥ï¸ Get Deployment Targets from Terraform Output
        id: terraform_output
        uses: hashicorp/terraform-github-actions/github-action@v2
        with:
          # Terraform ìƒíƒœ íŒŒì¼ì„ ì°¸ì¡°í•˜ì—¬ Outputs ê°’(S3 Bucket, CloudFront ID)ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
          tf_actions_state_backend_config: |
            bucket = "wealist-terraform-state-dev"
            key = "dev/wealist.tfstate"
            region = "ap-northeast-2"
          tf_actions_subcommand: "output"

      - name: ğŸ¯ Set Output Variables
        id: set_vars
        run: |
          # Output ê°’ì„ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •
          echo "S3_BUCKET=$(echo '${{ steps.terraform_output.outputs.frontend_s3_bucket_name }}')" >> $GITHUB_ENV
          echo "CLOUDFRONT_ID=$(echo '${{ steps.terraform_output.outputs.cloudfront_distribution_id }}')" >> $GITHUB_ENV
          
          # í™•ì¸ìš© ë¡œê·¸ (Secretsê°€ ì•„ë‹ˆë¯€ë¡œ ë…¸ì¶œ ê°€ëŠ¥)
          echo "S3 Target: ${{ env.S3_BUCKET }}"
          echo "CF ID: ${{ env.CLOUDFRONT_ID }}"

      # 2. AWS Credentials ì„¤ì •
      - name: ğŸ”‘ Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with