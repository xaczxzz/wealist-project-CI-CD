services:
  #--- Frontend ê°œë°œ í™˜ê²½ ì„¤ì • ---
  frontend-service:
    build:
      context: ./frontend
      # ğŸ’¡ ê°œë°œìš© Dockerfile ì§€ì •
      dockerfile: Dockerfile.local
    container_name: wealist-frontend-dev
    ports:
      - "3000:5173" # í˜¸ìŠ¤íŠ¸:ì»¨í…Œì´ë„ˆ (Vite HMR í¬íŠ¸)
    env_file: .env
    volumes:
      - ./frontend:/app
      - /app/node_modules # í˜¸ìŠ¤íŠ¸ ì˜¤ì—¼ ë°©ì§€ìš© ìµëª… ë³¼ë¥¨
    # ğŸ’¡ ê°œë°œ ì„œë²„ ì‹¤í–‰ ëª…ë ¹ (HMR í™œì„±í™”)
    command: pnpm dev --host 0.0.0.0 --port 5173 --strictPort
    networks:
      - wealist-net
    depends_on:
      - board-service
      - user-service
    restart: unless-stopped

  #-----ëª¨ë‹ˆí„°ë§ ë¶€ë¶„ (ê°œë°œ í™˜ê²½ì—ì„œ ì‚¬ìš©) ------#
  prometheus:
    user: "root"
    image: prom/prometheus
    container_name: prometheus_container
    volumes:
      - ./prometheus/config:/etc/prometheus
      - prometheus-data:/prometheus/data
    ports:
      - 9090:9090
    command:
      - "--web.enable-lifecycle"
      - "--config.file=/etc/prometheus/prometheus.yml"
    restart: always
    networks:
      - wealist-net

  grafana:
    user: "root"
    image: grafana/grafana
    container_name: grafana_container
    ports:
      - 9092:3000
    volumes:
      - grafana-storage:/var/lib/grafana
      - grafana-logs:/var/log/grafana
    restart: always
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
    networks:
      - wealist-net

  redis-exporter:
    image: oliver006/redis_exporter
    container_name: redis-exporter
    environment:
      - REDIS_ADDR=redis://redis:6379
      - REDIS_PASSWORD=${REDIS_PASSWORD}
    ports:
      - "9121:9121"
    networks:
      - wealist-net
    depends_on:
      - redis # Base íŒŒì¼ ì„œë¹„ìŠ¤ì— ì˜ì¡´
    restart: unless-stopped

  postgres-exporter:
    image: prometheuscommunity/postgres-exporter
    container_name: postgres-exporter
    environment:
      - DATA_SOURCE_NAME=postgresql://${POSTGRES_SUPERUSER}:${POSTGRES_SUPERUSER_PASSWORD}@postgres:5432/postgres?sslmode=disable
    ports:
      - "9187:9187"
    networks:
      - wealist-net
    depends_on:
      postgres: # Base íŒŒì¼ ì„œë¹„ìŠ¤ì— ì˜ì¡´
        condition: service_healthy
    restart: unless-stopped
# Base íŒŒì¼ì— ì •ì˜ëœ ë„¤íŠ¸ì›Œí¬ì™€ ë³¼ë¥¨ì„ ì°¸ì¡°í•˜ê¸° ìœ„í•œ ì„¤ì •
# networks:
#   wealist-net:
#     external: true

# volumes:
#   grafana-storage:
#     driver: local
#   grafana-logs:
#     driver: local
#   prometheus-data:
#     driver: local
